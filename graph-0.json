[
  {
    "name": "issues",
    "type": "Node",
    "children": [
      {
        "name": "expand",
        "type": "ObjectGraphLeaf",
        "value": "operations,editmeta,changelog,transitions,renderedFields"
      },
      {
        "name": "id",
        "type": "ObjectGraphLeaf",
        "value": "13015002"
      },
      {
        "name": "self",
        "type": "ObjectGraphLeaf",
        "value": "https://issues.apache.org/jira/rest/api/2/issue/13015002"
      },
      {
        "name": "key",
        "type": "ObjectGraphLeaf",
        "value": "SPARK-18091"
      },
      {
        "name": "fields",
        "type": "Node",
        "children": [
          {
            "name": "issuetype",
            "type": "Node",
            "children": [
              {
                "name": "self",
                "type": "ObjectGraphLeaf",
                "value": "https://issues.apache.org/jira/rest/api/2/issuetype/1"
              },
              {
                "name": "id",
                "type": "ObjectGraphLeaf",
                "value": "1"
              },
              {
                "name": "description",
                "type": "ObjectGraphLeaf",
                "value": "A problem which impairs or prevents the functions of the product."
              },
              {
                "name": "iconUrl",
                "type": "ObjectGraphLeaf",
                "value": "https://issues.apache.org/jira/images/icons/issuetypes/bug.png"
              },
              {
                "name": "name",
                "type": "ObjectGraphLeaf",
                "value": "Bug"
              },
              {
                "name": "subtask",
                "type": "ObjectGraphLeaf",
                "value": false
              }
            ]
          },
          {
            "name": "timespent",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "project",
            "type": "Node",
            "children": [
              {
                "name": "self",
                "type": "ObjectGraphLeaf",
                "value": "https://issues.apache.org/jira/rest/api/2/project/12315420"
              },
              {
                "name": "id",
                "type": "ObjectGraphLeaf",
                "value": "12315420"
              },
              {
                "name": "key",
                "type": "ObjectGraphLeaf",
                "value": "SPARK"
              },
              {
                "name": "name",
                "type": "ObjectGraphLeaf",
                "value": "Spark"
              },
              {
                "name": "avatarUrls",
                "type": "Node",
                "children": [
                  {
                    "name": "48x48",
                    "type": "ObjectGraphLeaf",
                    "value": "https://issues.apache.org/jira/secure/projectavatar?pid=12315420&avatarId=27346"
                  },
                  {
                    "name": "24x24",
                    "type": "ObjectGraphLeaf",
                    "value": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12315420&avatarId=27346"
                  },
                  {
                    "name": "16x16",
                    "type": "ObjectGraphLeaf",
                    "value": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12315420&avatarId=27346"
                  },
                  {
                    "name": "32x32",
                    "type": "ObjectGraphLeaf",
                    "value": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12315420&avatarId=27346"
                  }
                ]
              }
            ]
          },
          {
            "name": "fixVersions",
            "type": "ObjectGraphLeaf",
            "value": []
          },
          {
            "name": "aggregatetimespent",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "resolution",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312322",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12310220",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312520",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312323",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312521",
            "type": "ObjectGraphLeaf",
            "value": "Tue Oct 25 08:06:46 UTC 2016"
          },
          {
            "name": "customfield_12310420",
            "type": "ObjectGraphLeaf",
            "value": "9223372036854775807"
          },
          {
            "name": "customfield_12312320",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12310222",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312321",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312120",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312121",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "resolutiondate",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "workratio",
            "type": "ObjectGraphLeaf",
            "value": -1
          },
          {
            "name": "customfield_12312328",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312329",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312326",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12310300",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312327",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312324",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312325",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "lastViewed",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "watches",
            "type": "Node",
            "children": [
              {
                "name": "self",
                "type": "ObjectGraphLeaf",
                "value": "https://issues.apache.org/jira/rest/api/2/issue/SPARK-18091/watchers"
              },
              {
                "name": "watchCount",
                "type": "ObjectGraphLeaf",
                "value": 1
              },
              {
                "name": "isWatching",
                "type": "ObjectGraphLeaf",
                "value": false
              }
            ]
          },
          {
            "name": "created",
            "type": "ObjectGraphLeaf",
            "value": "2016-10-25T08:02:30.000+0000"
          },
          {
            "name": "priority",
            "type": "Node",
            "children": [
              {
                "name": "self",
                "type": "ObjectGraphLeaf",
                "value": "https://issues.apache.org/jira/rest/api/2/priority/2"
              },
              {
                "name": "iconUrl",
                "type": "ObjectGraphLeaf",
                "value": "https://issues.apache.org/jira/images/icons/priorities/critical.png"
              },
              {
                "name": "name",
                "type": "ObjectGraphLeaf",
                "value": "Critical"
              },
              {
                "name": "id",
                "type": "ObjectGraphLeaf",
                "value": "2"
              }
            ]
          },
          {
            "name": "labels",
            "type": "ObjectGraphLeaf",
            "value": []
          },
          {
            "name": "customfield_12312333",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312334",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12310310",
            "type": "ObjectGraphLeaf",
            "value": "0.0"
          },
          {
            "name": "customfield_12312331",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312332",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "timeestimate",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "aggregatetimeoriginalestimate",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312330",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12311120",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "versions",
            "type": "Node",
            "children": [
              {
                "name": "self",
                "type": "ObjectGraphLeaf",
                "value": "https://issues.apache.org/jira/rest/api/2/version/12334009"
              },
              {
                "name": "id",
                "type": "ObjectGraphLeaf",
                "value": "12334009"
              },
              {
                "name": "name",
                "type": "ObjectGraphLeaf",
                "value": "1.6.1"
              },
              {
                "name": "archived",
                "type": "ObjectGraphLeaf",
                "value": false
              },
              {
                "name": "released",
                "type": "ObjectGraphLeaf",
                "value": true
              },
              {
                "name": "releaseDate",
                "type": "ObjectGraphLeaf",
                "value": "2016-03-09"
              }
            ]
          },
          {
            "name": "issuelinks",
            "type": "ObjectGraphLeaf",
            "value": []
          },
          {
            "name": "customfield_12312339",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "assignee",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312337",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312338",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "updated",
            "type": "ObjectGraphLeaf",
            "value": "2016-10-25T08:06:46.000+0000"
          },
          {
            "name": "customfield_12312335",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312336",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "status",
            "type": "Node",
            "children": [
              {
                "name": "self",
                "type": "ObjectGraphLeaf",
                "value": "https://issues.apache.org/jira/rest/api/2/status/1"
              },
              {
                "name": "description",
                "type": "ObjectGraphLeaf",
                "value": "The issue is open and ready for the assignee to start work on it."
              },
              {
                "name": "iconUrl",
                "type": "ObjectGraphLeaf",
                "value": "https://issues.apache.org/jira/images/icons/statuses/open.png"
              },
              {
                "name": "name",
                "type": "ObjectGraphLeaf",
                "value": "Open"
              },
              {
                "name": "id",
                "type": "ObjectGraphLeaf",
                "value": "1"
              },
              {
                "name": "statusCategory",
                "type": "Node",
                "children": [
                  {
                    "name": "self",
                    "type": "ObjectGraphLeaf",
                    "value": "https://issues.apache.org/jira/rest/api/2/statuscategory/2"
                  },
                  {
                    "name": "id",
                    "type": "ObjectGraphLeaf",
                    "value": 2
                  },
                  {
                    "name": "key",
                    "type": "ObjectGraphLeaf",
                    "value": "new"
                  },
                  {
                    "name": "colorName",
                    "type": "ObjectGraphLeaf",
                    "value": "blue-gray"
                  },
                  {
                    "name": "name",
                    "type": "ObjectGraphLeaf",
                    "value": "New"
                  }
                ]
              }
            ]
          },
          {
            "name": "components",
            "type": "Node",
            "children": [
              {
                "name": "self",
                "type": "ObjectGraphLeaf",
                "value": "https://issues.apache.org/jira/rest/api/2/component/12322623"
              },
              {
                "name": "id",
                "type": "ObjectGraphLeaf",
                "value": "12322623"
              },
              {
                "name": "name",
                "type": "ObjectGraphLeaf",
                "value": "SQL"
              },
              {
                "name": "description",
                "type": "ObjectGraphLeaf",
                "value": "Spark SQL module"
              }
            ]
          },
          {
            "name": "timeoriginalestimate",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "description",
            "type": "ObjectGraphLeaf",
            "value": "*Problem Description:*\r\nI have an application in which a lot of if-else decisioning is involved to generate output. I'm getting following exception:\r\nCaused by: org.codehaus.janino.JaninoRuntimeException: Code of method \"(Lorg/apache/spark/sql/catalyst/expressions/GeneratedClass$SpecificUnsafeProjection;Lorg/apache/spark/sql/catalyst/InternalRow;)V\" of class \"org.apache.spark.sql.catalyst.expressions.GeneratedClass$SpecificUnsafeProjection\" grows beyond 64 KB\r\n\tat org.codehaus.janino.CodeContext.makeSpace(CodeContext.java:941)\r\n\tat org.codehaus.janino.CodeContext.write(CodeContext.java:874)\r\n\tat org.codehaus.janino.CodeContext.writeBranch(CodeContext.java:965)\r\n\tat org.codehaus.janino.UnitCompiler.writeBranch(UnitCompiler.java:10261)\r\n\r\n*Steps to Reproduce:*\r\nI've come up with a unit test which I was able to run in CodeGenerationSuite.scala:\r\n{code}\r\ntest(\"split large if expressions into blocks due to JVM code size limit\") {\r\n    val row = create_row(\"afafFAFFsqcategory2dadDADcategory8sasasadscategory24\", 0)\r\n    val inputStr = 'a.string.at(0)\r\n    val inputIdx = 'a.int.at(1)\r\n\r\n    val length = 10\r\n    val valuesToCompareTo = for (i <- 1 to (length + 1)) yield (\"category\" + i)\r\n\r\n    val initCondition = EqualTo(RegExpExtract(inputStr, Literal(\"category1\"), inputIdx), valuesToCompareTo(0))\r\n    var res: Expression = If(initCondition, Literal(\"category1\"), Literal(\"NULL\"))\r\n    var cummulativeCondition: Expression = Not(initCondition)\r\n    for (index <- 1 to length) {\r\n      val valueExtractedFromInput = RegExpExtract(inputStr, Literal(\"category\" + (index + 1).toString), inputIdx)\r\n      val currComparee = If(cummulativeCondition, valueExtractedFromInput, Literal(\"NULL\"))\r\n      val currCondition = EqualTo(currComparee, valuesToCompareTo(index))\r\n      val combinedCond = And(cummulativeCondition, currCondition)\r\n      res = If(combinedCond, If(combinedCond, valueExtractedFromInput, Literal(\"NULL\")), res)\r\n      cummulativeCondition = And(Not(currCondition), cummulativeCondition)\r\n    }\r\n\r\n    val expressions = Seq(res)\r\n    val plan = GenerateUnsafeProjection.generate(expressions, true)\r\n    val actual = plan(row).toSeq(expressions.map(_.dataType))\r\n    val expected = Seq(UTF8String.fromString(\"category2\"))\r\n\r\n    if (!checkResult(actual, expected)) {\r\n      fail(s\"Incorrect Evaluation: expressions: $expressions, actual: $actual, expected: $expected\")\r\n    }\r\n  }\r\n{code}\r\n\r\n*Root Cause:*\r\nCurrent splitting of Projection codes doesn't (and can't) take care of splitting the generated code for individual output column expressions. So it can grow to exceed JVM limit.\r\n\r\n*Note:* This issue seems related to SPARK-14887 but I'm not sure whether the root cause is same\r\n \r\n*Proposed Fix:*\r\nIf expression should place it's predicate, true value and false value expressions' generated code in separate methods in context and call these methods instead of putting the whole code directly in its generated code"
          },
          {
            "name": "customfield_10010",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312026",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312422",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312023",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12310320",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312024",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312420",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312340",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "aggregatetimeestimate",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312022",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312341",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312220",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12310921",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12310920",
            "type": "ObjectGraphLeaf",
            "value": "9223372036854775807"
          },
          {
            "name": "summary",
            "type": "ObjectGraphLeaf",
            "value": "Deep if expressions cause Generated SpecificUnsafeProjection code to exceed JVM code size limit"
          },
          {
            "name": "creator",
            "type": "Node",
            "children": [
              {
                "name": "self",
                "type": "ObjectGraphLeaf",
                "value": "https://issues.apache.org/jira/rest/api/2/user?username=kapilsingh5050"
              },
              {
                "name": "name",
                "type": "ObjectGraphLeaf",
                "value": "kapilsingh5050"
              },
              {
                "name": "emailAddress",
                "type": "ObjectGraphLeaf",
                "value": "kapilsingh5050 at gmail dot com"
              },
              {
                "name": "avatarUrls",
                "type": "Node",
                "children": [
                  {
                    "name": "48x48",
                    "type": "ObjectGraphLeaf",
                    "value": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
                  },
                  {
                    "name": "24x24",
                    "type": "ObjectGraphLeaf",
                    "value": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452"
                  },
                  {
                    "name": "16x16",
                    "type": "ObjectGraphLeaf",
                    "value": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452"
                  },
                  {
                    "name": "32x32",
                    "type": "ObjectGraphLeaf",
                    "value": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                  }
                ]
              },
              {
                "name": "displayName",
                "type": "ObjectGraphLeaf",
                "value": "Kapil Singh"
              },
              {
                "name": "active",
                "type": "ObjectGraphLeaf",
                "value": true
              }
            ]
          },
          {
            "name": "subtasks",
            "type": "ObjectGraphLeaf",
            "value": []
          },
          {
            "name": "customfield_12310291",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "reporter",
            "type": "Node",
            "children": [
              {
                "name": "self",
                "type": "ObjectGraphLeaf",
                "value": "https://issues.apache.org/jira/rest/api/2/user?username=kapilsingh5050"
              },
              {
                "name": "name",
                "type": "ObjectGraphLeaf",
                "value": "kapilsingh5050"
              },
              {
                "name": "emailAddress",
                "type": "ObjectGraphLeaf",
                "value": "kapilsingh5050 at gmail dot com"
              },
              {
                "name": "avatarUrls",
                "type": "Node",
                "children": [
                  {
                    "name": "48x48",
                    "type": "ObjectGraphLeaf",
                    "value": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
                  },
                  {
                    "name": "24x24",
                    "type": "ObjectGraphLeaf",
                    "value": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452"
                  },
                  {
                    "name": "16x16",
                    "type": "ObjectGraphLeaf",
                    "value": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452"
                  },
                  {
                    "name": "32x32",
                    "type": "ObjectGraphLeaf",
                    "value": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                  }
                ]
              },
              {
                "name": "displayName",
                "type": "ObjectGraphLeaf",
                "value": "Kapil Singh"
              },
              {
                "name": "active",
                "type": "ObjectGraphLeaf",
                "value": true
              }
            ]
          },
          {
            "name": "customfield_12310290",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "aggregateprogress",
            "type": "Node",
            "children": [
              {
                "name": "progress",
                "type": "ObjectGraphLeaf",
                "value": 0
              },
              {
                "name": "total",
                "type": "ObjectGraphLeaf",
                "value": 0
              }
            ]
          },
          {
            "name": "customfield_12311024",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "environment",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12311020",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "duedate",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12310250",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "progress",
            "type": "Node",
            "children": [
              {
                "name": "progress",
                "type": "ObjectGraphLeaf",
                "value": 0
              },
              {
                "name": "total",
                "type": "ObjectGraphLeaf",
                "value": 0
              }
            ]
          },
          {
            "name": "votes",
            "type": "Node",
            "children": [
              {
                "name": "self",
                "type": "ObjectGraphLeaf",
                "value": "https://issues.apache.org/jira/rest/api/2/issue/SPARK-18091/votes"
              },
              {
                "name": "votes",
                "type": "ObjectGraphLeaf",
                "value": 0
              },
              {
                "name": "hasVoted",
                "type": "ObjectGraphLeaf",
                "value": false
              }
            ]
          },
          {
            "name": "customfield_12311820",
            "type": "ObjectGraphLeaf",
            "value": "0|i35cjb:"
          },
          {
            "name": "customfield_12311620",
            "type": "ObjectGraphLeaf",
            "value": null
          }
        ]
      }
    ]
  },
  {
    "name": "issues",
    "type": "Node",
    "children": [
      {
        "name": "expand",
        "type": "ObjectGraphLeaf",
        "value": "operations,editmeta,changelog,transitions,renderedFields"
      },
      {
        "name": "id",
        "type": "ObjectGraphLeaf",
        "value": "13014991"
      },
      {
        "name": "self",
        "type": "ObjectGraphLeaf",
        "value": "https://issues.apache.org/jira/rest/api/2/issue/13014991"
      },
      {
        "name": "key",
        "type": "ObjectGraphLeaf",
        "value": "SPARK-18090"
      },
      {
        "name": "fields",
        "type": "Node",
        "children": [
          {
            "name": "issuetype",
            "type": "Node",
            "children": [
              {
                "name": "self",
                "type": "ObjectGraphLeaf",
                "value": "https://issues.apache.org/jira/rest/api/2/issuetype/1"
              },
              {
                "name": "id",
                "type": "ObjectGraphLeaf",
                "value": "1"
              },
              {
                "name": "description",
                "type": "ObjectGraphLeaf",
                "value": "A problem which impairs or prevents the functions of the product."
              },
              {
                "name": "iconUrl",
                "type": "ObjectGraphLeaf",
                "value": "https://issues.apache.org/jira/images/icons/issuetypes/bug.png"
              },
              {
                "name": "name",
                "type": "ObjectGraphLeaf",
                "value": "Bug"
              },
              {
                "name": "subtask",
                "type": "ObjectGraphLeaf",
                "value": false
              }
            ]
          },
          {
            "name": "timespent",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "project",
            "type": "Node",
            "children": [
              {
                "name": "self",
                "type": "ObjectGraphLeaf",
                "value": "https://issues.apache.org/jira/rest/api/2/project/12315420"
              },
              {
                "name": "id",
                "type": "ObjectGraphLeaf",
                "value": "12315420"
              },
              {
                "name": "key",
                "type": "ObjectGraphLeaf",
                "value": "SPARK"
              },
              {
                "name": "name",
                "type": "ObjectGraphLeaf",
                "value": "Spark"
              },
              {
                "name": "avatarUrls",
                "type": "Node",
                "children": [
                  {
                    "name": "48x48",
                    "type": "ObjectGraphLeaf",
                    "value": "https://issues.apache.org/jira/secure/projectavatar?pid=12315420&avatarId=27346"
                  },
                  {
                    "name": "24x24",
                    "type": "ObjectGraphLeaf",
                    "value": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12315420&avatarId=27346"
                  },
                  {
                    "name": "16x16",
                    "type": "ObjectGraphLeaf",
                    "value": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12315420&avatarId=27346"
                  },
                  {
                    "name": "32x32",
                    "type": "ObjectGraphLeaf",
                    "value": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12315420&avatarId=27346"
                  }
                ]
              }
            ]
          },
          {
            "name": "fixVersions",
            "type": "ObjectGraphLeaf",
            "value": []
          },
          {
            "name": "aggregatetimespent",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "resolution",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312322",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12310220",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312520",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312323",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312521",
            "type": "ObjectGraphLeaf",
            "value": "2016-10-25 06:30:24.0"
          },
          {
            "name": "customfield_12310420",
            "type": "ObjectGraphLeaf",
            "value": "9223372036854775807"
          },
          {
            "name": "customfield_12312320",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12310222",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312321",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312120",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312121",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "resolutiondate",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "workratio",
            "type": "ObjectGraphLeaf",
            "value": -1
          },
          {
            "name": "customfield_12312328",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312329",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312326",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12310300",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312327",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312324",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312325",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "lastViewed",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "watches",
            "type": "Node",
            "children": [
              {
                "name": "self",
                "type": "ObjectGraphLeaf",
                "value": "https://issues.apache.org/jira/rest/api/2/issue/SPARK-18090/watchers"
              },
              {
                "name": "watchCount",
                "type": "ObjectGraphLeaf",
                "value": 1
              },
              {
                "name": "isWatching",
                "type": "ObjectGraphLeaf",
                "value": false
              }
            ]
          },
          {
            "name": "created",
            "type": "ObjectGraphLeaf",
            "value": "2016-10-25T06:30:24.000+0000"
          },
          {
            "name": "priority",
            "type": "Node",
            "children": [
              {
                "name": "self",
                "type": "ObjectGraphLeaf",
                "value": "https://issues.apache.org/jira/rest/api/2/priority/3"
              },
              {
                "name": "iconUrl",
                "type": "ObjectGraphLeaf",
                "value": "https://issues.apache.org/jira/images/icons/priorities/major.png"
              },
              {
                "name": "name",
                "type": "ObjectGraphLeaf",
                "value": "Major"
              },
              {
                "name": "id",
                "type": "ObjectGraphLeaf",
                "value": "3"
              }
            ]
          },
          {
            "name": "labels",
            "type": "ObjectGraphLeaf",
            "value": []
          },
          {
            "name": "customfield_12312333",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312334",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12310310",
            "type": "ObjectGraphLeaf",
            "value": "0.0"
          },
          {
            "name": "customfield_12312331",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312332",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "timeestimate",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "aggregatetimeoriginalestimate",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312330",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12311120",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "versions",
            "type": "Node",
            "children": [
              {
                "name": "self",
                "type": "ObjectGraphLeaf",
                "value": "https://issues.apache.org/jira/rest/api/2/version/12334009"
              },
              {
                "name": "id",
                "type": "ObjectGraphLeaf",
                "value": "12334009"
              },
              {
                "name": "name",
                "type": "ObjectGraphLeaf",
                "value": "1.6.1"
              },
              {
                "name": "archived",
                "type": "ObjectGraphLeaf",
                "value": false
              },
              {
                "name": "released",
                "type": "ObjectGraphLeaf",
                "value": true
              },
              {
                "name": "releaseDate",
                "type": "ObjectGraphLeaf",
                "value": "2016-03-09"
              }
            ]
          },
          {
            "name": "issuelinks",
            "type": "ObjectGraphLeaf",
            "value": []
          },
          {
            "name": "customfield_12312339",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "assignee",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312337",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312338",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "updated",
            "type": "ObjectGraphLeaf",
            "value": "2016-10-25T06:33:28.000+0000"
          },
          {
            "name": "customfield_12312335",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312336",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "status",
            "type": "Node",
            "children": [
              {
                "name": "self",
                "type": "ObjectGraphLeaf",
                "value": "https://issues.apache.org/jira/rest/api/2/status/1"
              },
              {
                "name": "description",
                "type": "ObjectGraphLeaf",
                "value": "The issue is open and ready for the assignee to start work on it."
              },
              {
                "name": "iconUrl",
                "type": "ObjectGraphLeaf",
                "value": "https://issues.apache.org/jira/images/icons/statuses/open.png"
              },
              {
                "name": "name",
                "type": "ObjectGraphLeaf",
                "value": "Open"
              },
              {
                "name": "id",
                "type": "ObjectGraphLeaf",
                "value": "1"
              },
              {
                "name": "statusCategory",
                "type": "Node",
                "children": [
                  {
                    "name": "self",
                    "type": "ObjectGraphLeaf",
                    "value": "https://issues.apache.org/jira/rest/api/2/statuscategory/2"
                  },
                  {
                    "name": "id",
                    "type": "ObjectGraphLeaf",
                    "value": 2
                  },
                  {
                    "name": "key",
                    "type": "ObjectGraphLeaf",
                    "value": "new"
                  },
                  {
                    "name": "colorName",
                    "type": "ObjectGraphLeaf",
                    "value": "blue-gray"
                  },
                  {
                    "name": "name",
                    "type": "ObjectGraphLeaf",
                    "value": "New"
                  }
                ]
              }
            ]
          },
          {
            "name": "components",
            "type": "Node",
            "children": [
              {
                "name": "self",
                "type": "ObjectGraphLeaf",
                "value": "https://issues.apache.org/jira/rest/api/2/component/12322623"
              },
              {
                "name": "id",
                "type": "ObjectGraphLeaf",
                "value": "12322623"
              },
              {
                "name": "name",
                "type": "ObjectGraphLeaf",
                "value": "SQL"
              },
              {
                "name": "description",
                "type": "ObjectGraphLeaf",
                "value": "Spark SQL module"
              }
            ]
          },
          {
            "name": "timeoriginalestimate",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "description",
            "type": "ObjectGraphLeaf",
            "value": "*Problem Description:*\r\nReading a small parquet file (single column, single record), with provided schema (StructType(Seq(StructField(\"field1\",StringType,true), StructField(\"hour\",StringType,true),StructField(\"batch\",StringType,true)))) and with spark.sql.sources.partitionColumnTypeInference.enabled not set (i.e. defaulting to true) from a path like \"<base-path>/hour=2016072313/batch=720b044894e14dcea63829bb4686c7e3\" gives following exception:\r\njava.lang.NegativeArraySizeException\r\n\tat org.apache.spark.sql.catalyst.expressions.codegen.BufferHolder.grow(BufferHolder.java:45)\r\n\tat org.apache.spark.sql.catalyst.expressions.codegen.UnsafeRowWriter.write(UnsafeRowWriter.java:196)\r\n\tat org.apache.spark.sql.catalyst.expressions.GeneratedClass$SpecificUnsafeProjection.apply(Unknown Source)\r\n\tat org.apache.spark.sql.execution.datasources.DataSourceStrategy$$anonfun$17$$anonfun$apply$8.apply(DataSourceStrategy.scala:239)\r\n\tat org.apache.spark.sql.execution.datasources.DataSourceStrategy$$anonfun$17$$anonfun$apply$8.apply(DataSourceStrategy.scala:238)\r\n\tat scala.collection.Iterator$$anon$11.next(Iterator.scala:328)\r\n\tat scala.collection.Iterator$$anon$11.next(Iterator.scala:328)\r\n\tat scala.collection.Iterator$$anon$11.next(Iterator.scala:328)\r\nwhich is completely wrong behavior.\r\n\r\n*Steps to Reproduce:*\r\nRun following commands from Spark shell (after updating paths):\r\n{code}\r\nval df = sc.parallelize(Seq((\"one\", \"2016072313\", \"720b044894e14dcea63829bb4686c7e3\"))).toDF(\"field1\", \"hour\", \"batch\")\r\ndf.write.partitionBy(\"hour\", \"batch\").parquet(\"/home/<user>/SmallParquetForTest\")\r\nimport org.apache.spark.sql.types._\r\nval schema = StructType(Seq(StructField(\"field1\",StringType,true), StructField(\"hour\",StringType,true),StructField(\"batch\",StringType,true)))\r\nval dfRead = sqlContext.read.schema(sparkSchema).parquet(\"file:///home/<user>/SmallParquetForTest\")\r\ndfRead.show()\r\n{code}\r\n\r\n*Root Cause:*\r\nI did some analysis by debugging this in Spark and found out that the partition Projection uses inferred schema and generates a row with \"hour\" as integer. Later on final projection uses provided schema and reads \"hour\" as string from the row generated by partition projection. While reading \"hour\" as string, it's integer value 2016072313 is interpreted as size of the string to be read which causes byte buffer size overflow.\r\n\r\n*Expected Behavior:*\r\nEither there should be an error saying inferred type and provided type for partition columns do not match or provided type should be used while generating partition projection."
          },
          {
            "name": "customfield_10010",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312026",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312422",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312023",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12310320",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312024",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312420",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312340",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "aggregatetimeestimate",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312022",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312341",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12312220",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12310921",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12310920",
            "type": "ObjectGraphLeaf",
            "value": "9223372036854775807"
          },
          {
            "name": "summary",
            "type": "ObjectGraphLeaf",
            "value": "NegativeArraySize exception while reading parquet when inferred type and provided type for partition column are different"
          },
          {
            "name": "creator",
            "type": "Node",
            "children": [
              {
                "name": "self",
                "type": "ObjectGraphLeaf",
                "value": "https://issues.apache.org/jira/rest/api/2/user?username=kapilsingh5050"
              },
              {
                "name": "name",
                "type": "ObjectGraphLeaf",
                "value": "kapilsingh5050"
              },
              {
                "name": "emailAddress",
                "type": "ObjectGraphLeaf",
                "value": "kapilsingh5050 at gmail dot com"
              },
              {
                "name": "avatarUrls",
                "type": "Node",
                "children": [
                  {
                    "name": "48x48",
                    "type": "ObjectGraphLeaf",
                    "value": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
                  },
                  {
                    "name": "24x24",
                    "type": "ObjectGraphLeaf",
                    "value": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452"
                  },
                  {
                    "name": "16x16",
                    "type": "ObjectGraphLeaf",
                    "value": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452"
                  },
                  {
                    "name": "32x32",
                    "type": "ObjectGraphLeaf",
                    "value": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                  }
                ]
              },
              {
                "name": "displayName",
                "type": "ObjectGraphLeaf",
                "value": "Kapil Singh"
              },
              {
                "name": "active",
                "type": "ObjectGraphLeaf",
                "value": true
              }
            ]
          },
          {
            "name": "subtasks",
            "type": "ObjectGraphLeaf",
            "value": []
          },
          {
            "name": "customfield_12310291",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "reporter",
            "type": "Node",
            "children": [
              {
                "name": "self",
                "type": "ObjectGraphLeaf",
                "value": "https://issues.apache.org/jira/rest/api/2/user?username=kapilsingh5050"
              },
              {
                "name": "name",
                "type": "ObjectGraphLeaf",
                "value": "kapilsingh5050"
              },
              {
                "name": "emailAddress",
                "type": "ObjectGraphLeaf",
                "value": "kapilsingh5050 at gmail dot com"
              },
              {
                "name": "avatarUrls",
                "type": "Node",
                "children": [
                  {
                    "name": "48x48",
                    "type": "ObjectGraphLeaf",
                    "value": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
                  },
                  {
                    "name": "24x24",
                    "type": "ObjectGraphLeaf",
                    "value": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452"
                  },
                  {
                    "name": "16x16",
                    "type": "ObjectGraphLeaf",
                    "value": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452"
                  },
                  {
                    "name": "32x32",
                    "type": "ObjectGraphLeaf",
                    "value": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                  }
                ]
              },
              {
                "name": "displayName",
                "type": "ObjectGraphLeaf",
                "value": "Kapil Singh"
              },
              {
                "name": "active",
                "type": "ObjectGraphLeaf",
                "value": true
              }
            ]
          },
          {
            "name": "customfield_12310290",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "aggregateprogress",
            "type": "Node",
            "children": [
              {
                "name": "progress",
                "type": "ObjectGraphLeaf",
                "value": 0
              },
              {
                "name": "total",
                "type": "ObjectGraphLeaf",
                "value": 0
              }
            ]
          },
          {
            "name": "customfield_12311024",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "environment",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12311020",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "duedate",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "customfield_12310250",
            "type": "ObjectGraphLeaf",
            "value": null
          },
          {
            "name": "progress",
            "type": "Node",
            "children": [
              {
                "name": "progress",
                "type": "ObjectGraphLeaf",
                "value": 0
              },
              {
                "name": "total",
                "type": "ObjectGraphLeaf",
                "value": 0
              }
            ]
          },
          {
            "name": "votes",
            "type": "Node",
            "children": [
              {
                "name": "self",
                "type": "ObjectGraphLeaf",
                "value": "https://issues.apache.org/jira/rest/api/2/issue/SPARK-18090/votes"
              },
              {
                "name": "votes",
                "type": "ObjectGraphLeaf",
                "value": 0
              },
              {
                "name": "hasVoted",
                "type": "ObjectGraphLeaf",
                "value": false
              }
            ]
          },
          {
            "name": "customfield_12311820",
            "type": "ObjectGraphLeaf",
            "value": "0|i35cgv:"
          },
          {
            "name": "customfield_12311620",
            "type": "ObjectGraphLeaf",
            "value": null
          }
        ]
      }
    ]
  }
]